# AutoDto

AutoDto is a C# [source generator](https://learn.microsoft.com/en-us/dotnet/csharp/roslyn-sdk/source-generators-overview) for scaffolding basic data transfer object (DTO) classes from database model classes. When exposing an API to perform CRUD operations it is often desirable to separate the user-facing data structures from those mapped to the underlying schema. For instance, a request to create a new entry might not expose an ID field if it is automatically generated by the database, but such a field will be present in a model scaffolded by an [ORM](https://en.wikipedia.org/wiki/Object%E2%80%93relational_mapping). AutoDto was created to ease the burden of writing lots of boilerplate DTO classes that are often very similar to their corresponding DB models.

AutoDto is aimed at projects utilizing [Entity Framework Core](https://learn.microsoft.com/en-us/ef/core/), and will only generate DTOs for types referenced in a class deriving from `DbContext`. 
This is implemented simply by searching through the root namespace of the assembly where AutoDto is added and searching recursively for the first class derived from `DbContext` - there is no logic in place to ensure that this is in fact Entity Framework Core, just that the base type is named DbContext.
Once a subclass of `DbContext` is found, AutoDto iterates over each property of the class that is a `DbSet`, and scaffolds Request/Response DTO classes for the types referenced in the DbSets.

Note that the current implementation is very simple, and **will only handle properties** in the target classes. It is designed to handle basic object properties as well as `ICollection`s - basically, if you've [scaffolded your EF models](https://learn.microsoft.com/en-us/ef/core/managing-schemas/scaffolding/?tabs=dotnet-core-cli) from an existing database, AutoDto should be fully compatible with your project.

Generated classes support recursion - for instance, if you have a class named `Child`, and another class `Parent` that has a property of type `ICollection<Child>`, then AutoDto would generate the class `CreateParentRequest` with a property of type `ICollection<CreateChildRequest>` as long as the `Child` class is also targeted for scaffolding (see [the Configuration section](#Configuration)).

## Installation

AutoDto is packaged using nuget, [hosted at this link.](https://www.nuget.org/packages/AutoEfDto/)

To install, open a terminal in your project directory and run the following:
`dotnet add package AutoEfDto --version 1.0.1`

Or in the Visual Studio Package Manager Console:
`NuGet\Install-Package AutoEfDto -Version 1.0.1`

## Basic Usage

A typical project utilizing EF Core will contain a database context class:
```cs
internal class ExampleDbContext : DbContext
{
    public virtual DbSet<ParentClass> ParentClass { get; set; }

    public virtual DbSet<ChildClass> ChildClass { get; set; }
}
```

As well as model classes corresponding to the database tables:
```cs
// ChildClass.cs
internal class ChildClass
{
    public int Id { get; set; }
    public string Name { get; set; }
}

// ParentClass.cs
internal class ParentClass
{
    public int Id { get; set; }
    public virtual ChildClass? FavoriteChild { get; set; } = null!;
    public virtual ICollection<ChildClass> Children { get; set; } = new List<ChildClass>();
}
```

In its default configuration, AutoDto would generate separate Create, Read, Update, and Delete request DTOs as follows:
```cs
// CreateChildClassRequest.cs
internal class CreateChildClassRequest
{
    public int Id { get; set; }
    public string Name { get; set; }
}

// CreateParentClassRequest.cs
internal class CreateParentClassRequest
{
    public int Id { get; set; }
    public CreateChildClassRequest? FavoriteChild { get; set; } = null!;
    public ICollection<CreateChildClassRequest> Children { get; set; } = new List<ChildClass>();
}
```
As well as a generic response DTO for each type:
```cs
// ChildClassResponse.cs
internal class ChildClassResponse
{
    public int Id { get; set; }
    public string Name { get; set; }
}

// ParentClassResponse.cs
internal class ParentClassResponse
{
    public int Id { get; set; }
    public ChildClassResponse? FavoriteChild { get; set; } = null!;
    public ICollection<ChildClassResponse> Children { get; set; } = new List<ChildClass>();
}
```

By default, request DTOs follow the naming convention `"{RequestType}{BaseClassName}Request"` where `RequestType` is one of "Create", "Read", "Update", or "Delete".

## Configuration

TODO: Expand

## Contributing

TODO: Expand

Pull requests are welcome. For major changes, please open an issue first
to discuss what you would like to change.

## License

[MIT](https://choosealicense.com/licenses/mit/)
